---
title: TLS协议
date: 2025-06-19 18:57:15
categories: 计算机网络知识
---

TLS协议是所属于HTTPS中使用的协议

# HTTP和HTTPS的区别

- 传输数据形式：HTTP为明文传输数据，外部进行抓包就可以获取请求参数和数据，比较危险；HTTPS引入**SSL/TLS协议**（SSL协议是TLS协议的前身），TLS会对数据加密后再传输，安全性高，同时具有数字证书保证传输过程的数据不会被篡改

- 建立连接：HTTP请求之前只需要通过TCP三次握手，而HTTPS请求之前需要通过TCP三次握手后，再通过TLS四次握手
- 端口号：HTTP默认为80端口，HTTPS默认为443端口
- 数字证书：HTTPS通过第三方CA颁发的数字证书来验证请求者的身份和数据是否被篡改；而HTTP不具有数字证书来验证身份

# TLS协议作用

当HTTPS经过TCP三次握手之后，还会进行TLS四次握手

TLS主要是为了保证数据通信的安全性，不会轻易将数据的明文形式显示出来

## TLS的加密算法

### 1.对称加密算法

- 该算法只有一个密钥（该密钥不能明文传递），通过该密钥可以对数据进行加密和解密操作

- 适用于对大量数据加解密操作（加解密速度快）
- AES、DES算法

### 2.非对称加密算法

- 该算法具有一对密钥（公钥和私钥），一般使用公钥对数据加密，使用私钥对数据解密。公钥可以随意分发，私钥需要保护起来

- 适用于对少量数据加解密（加解密速度较慢）；一般用于密钥交换和数字签名

- RSA、ECC算法

### 3.哈希算法

- 哈希算法是一种单向算法，可以通过哈希算法对数据进行哈希计算生成哈希数据，该哈希数据不能被解密来获取原始数据，只能通过相同的哈希算法对原始数据计算后得到哈希值来比对是否相同
- 适用于校验数据完整性
- MD5算法



## HTTPS的混合加密

HTTPS将对称加密和非对称加密混合使用

- 首先使用非对称加密算法来交换“对称密钥”
- 后续整个通信过程中，使用该“对称密钥”对明文数据对称加密后再传输



# TLS四次握手

当客户端和服务端TCP三次握手后，会进行TLS四次握手

## TLS第一次握手

客户端对服务端发送hello信息，并生成一个随机数和密码套件传递过去

## TLS第二次握手

服务端收到客户端消息后，会选择一套合适的密码套件（密钥交换算法、签名算法、对称加密算法、摘要算法），生成第二个随机数，还有其服务端对应的数字证书一并发送给客户端

### 数字证书--保证公钥持有者身份不被冒充

- 数字证书中包含服务端公钥和CA公钥，CA公钥是用来解密数字证书的，校验数字证书是否合法，而服务端公钥可以直接从数字证书中取出，用于后续非对称加密算法；数字证书的作用是用来认证公钥持有者身份，防止公钥被冒充发送给客户端

- 数字证书通过CA机构（相当于网络世界的公安局）颁发，具有可信度

## TLS第三次握手

- 在进行第三次握手前，会使用CA公钥校验数字证书是否合法，然后从数字证书中取出服务端公钥

- 客户端会生成第三个随机数，使用服务端公钥加密后传输给服务端，服务端用私钥解密得到第三个随机数，此时客户端和服务端都拥有了三个随机数
- 客户端和服务端双方都根据这三个随机数生成对称密钥；然后客户端发送开始使用对称加密的消息给服务端，并且对之前所有的数据做个摘要，然后对称加密一下发送给服务端校验，校验对称加密是否可用，和数据是否被篡改

## TLS第四次握手

服务端同样地，也向客户端发送准备开始使用对称加密的消息，然后对之前的数据做个摘要，对称加密后发送给客户端，客户端校验成功后则完成四次握手

**TLS四次握手成功后，则开始使用对称加密算法加密数据后传输**



### 数字签名--防止数据被篡改或者身份被冒充

**加密只能确保数据不被监听**

- 假设Alice是接收方，Bob是发送方

- 黑客也可以使用 Alice 的公钥冒充 Bob 给 Alice 发邮件啊，因为 Alice 的公钥本来就是公开的，任何人都可以获得。

- 由于 黑客 也可以获得 Alice 公钥，所以没法防止 黑客 伪造和篡改，并且对于 Alice 而言，她无法分辨出邮件到底是 Eve 发的还是 Bob

所以需要数字签名，私钥加密，公钥解密

- 首先Bob将公钥发送给Alice，然后后续传输数据使用私钥对内容数字签名

- Bob 自己的私钥，Bob 用自己的私钥对邮件内容计算一个「签名」，将「签名」和邮件内容一起发送出去，接受者 Alice 可以使用 Bob 的公钥验证这个签名是否正确，这就叫「验签」（发送方和接收方都拥有自己的一对公钥、私钥）

#### 数字签名的计算

一般做法是先将原数据进行 Hash 运算（hash算法），得到的 Hash 值就叫做「摘要」。

「摘要」就像人的指纹一样，可以代表一个人，只要内容发生了改变，计算出来的摘要也应该变化。

「摘要」最好是不可逆转的，一般使用开头提到的 MD5 作为 Hash 函数，MD5 输出的结果固定位 128 位

哈希算法得到的数字签名是不可逆的

![img](https://j114chuk046.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmI1NzM1YzI4MjcyMjdjMTJkYjRhMTc3NTMxYTc1NzhfOUhjM2RnbjFla3RMcWo4R2JSUmM1Z29PQmpTeFdjUHdfVG9rZW46RkxsOWJGems3b0JtMVl4czhiZWM1Nld0bnVmXzE3NTAzMzYxOTc6MTc1MDMzOTc5N19WNA)

再通过对得到的摘要使用私钥加密后得到数字签名

#### 怎么使用数字签名验证身份

发送数据会有数字签名+数据内容

![img](https://j114chuk046.feishu.cn/space/api/box/stream/download/asynccode/?code=MjUxM2NkNTNlMzE3Y2FjNWU3YTZjMDBmOGI3NjMwNzFfTjAyV0hVSnEzQUxTNjlzZjNMWU1iUFFiUWV4aUdYQXZfVG9rZW46WG41T2JjNnk3b05uOFl4Wmd6c2NYMVVYbmdkXzE3NTAzMzYxOTc6MTc1MDMzOTc5N19WNA)

- 接受者 Alice 收到后，取下数字签名，同时用 Bob 的公钥解密，得到「摘要1」，证明确实是 Bob 发的。

( 画外音：如果使用 Bob 的公钥验证签名出错，那么签名一定不是 Bob 的私钥生成的）

- 再对邮件内容使用相同的散列函数计算「摘要2」，与上面得到的「摘要1」进行对比，两者一致就说明信息未被篡改。

- 数字签名是通过对邮件正文哈希计算，然后使用私钥加密而生成的，所以使用公钥解密数字签名后，得到的是哈希计算后的邮件正文

这样两部分证明发送者身份和保证数据未被篡改。
