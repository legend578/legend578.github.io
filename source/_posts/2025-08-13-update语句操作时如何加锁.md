---
title: update语句操作时如何加锁
date: 2025-08-13 17:12:01
tags:
---

# update语句操作时是怎么加锁的？

**InnoDB加锁是在索引上加锁的，所以update操作加锁需要分情况讨论**

在可重复读隔离级别中：
例如update table1 set age = 18 where name = '张三'这个语句
1.更新条件里的字段（where条件中的name）是唯一索引：

- 如果更新条件匹配到记录，则将该记录对应的唯一索引和主键索引加上记录锁
- 如果更新条件没有匹配到记录，则将第一个不符合更新条件的记录在唯一索引上加上间隙锁


2.更新条件里的字段（where条件中的name）是非唯一索引：
- 如果更新条件匹配到记录，由于非唯一索引会存在多个重复值，所以加锁的时候会将所有匹配到的记录对应的非唯一索引加上next-key锁，对第一个不符合更新条件的记录在非唯一索引加锁间隙锁，对应的主键索引会加上记录锁
- 如果更新条件没有匹配到记录，会对第一个不符合更新条件的记录在非唯一索引加锁间隙锁


3.更新条件不存在，或者条件里的字段（name）没有索引或没有命中索引：
会全表扫描（扫描主键索引里所有的叶子结点），对所有记录加上next-key锁，相当于锁住了整张表